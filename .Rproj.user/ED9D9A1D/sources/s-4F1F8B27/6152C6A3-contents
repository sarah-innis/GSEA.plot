#### remove extras from key ####
data(key)
old_key=key
new_key=old_key[1:68,]
key=new_key
key=as.data.frame(key)
use_data(key,overwrite=TRUE)


### write a pheno.input function ###
setwd("C:/Users/Student/Documents/CivelekLab/August_Edits")
fname = "lab_gtexSubq_gsea.txt"
ann = read.table(fname) %>% t
ann = as.character(ann)
use_data(gtex_ann)
pheno.input=create_phenoinput(ann)

data(hallmark.gs)
gene.set.input=hallmark.gs

fname = "expr_gtexSubq_gsea.txt"
expr = read.table(fname,header=T,stringsAsFactors=F)
# format expr
expr2 = expr[!(duplicated(expr[,1])==T),]
expr.input = expr2[,3:ncol(expr2)]
rownames(expr.input) = expr2[,1]

pp = GSEAplots(input.ds.name = expr.input, input.cls.name = pheno.input,
               gene.set.input = gene.set.input, doc.string = "gtex6p_wKLFNEW",
               nperm = 1000, nom.p.val.threshold = -1, fdr.q.val.threshold = 1,
               bar_percent = 0.1, gap_percent = 0.1, under_percent = 0.1,
               upper_percent = 0.1, color_line = "black", color_tick = "black",
               abs.val = F, gs.size.threshold.max=1000)
